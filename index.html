<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hokkaido 2026 Pro</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #FDFBF7; /* ç±³ç™½è‰² */
            --card-bg: #FFFFFF;
            --primary: #2C3E50;
        }
        
        body {
            font-family: 'Zen Maru Gothic', 'Noto Sans SC', sans-serif;
            background-color: var(--bg-color);
            color: #333;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 100px;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background-color: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            border: 1px solid rgba(0,0,0,0.02);
            transition: transform 0.2s;
        }

        /* å¤©æ°”å°ç»„ä»¶æ ·å¼ */
        .weather-pill {
            font-size: 11px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(4px);
            padding: 4px 10px;
            border-radius: 20px;
            border: 1px solid #E2E8F0;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #4A5568;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .weather-loading { color: #A0AEC0; }

        /* æ ‡ç­¾ç³»ç»Ÿ */
        .tag-box {
            font-size: 11px;
            padding: 8px;
            border-radius: 8px;
            margin-top: 8px;
            line-height: 1.6;
        }
        .must-eat { background-color: #FFFAF0; border-left: 3px solid #F6AD55; color: #9C4221; }
        .must-buy { background-color: #F0FFF4; border-left: 3px solid #68D391; color: #276749; }
        .story-box { background-color: #F7FAFC; border: 1px dashed #CBD5E0; color: #4A5568; }

        /* æ”»ç•¥æŠ˜å é¢æ¿ */
        details > summary {
            list-style: none;
            cursor: pointer;
            font-size: 12px;
            color: #718096;
            font-weight: bold;
            display: flex;
            align-items: center;
            margin-top: 8px;
        }
        details > summary::-webkit-details-marker { display: none; }
        details > summary::before {
            content: 'ğŸ‘‰';
            margin-right: 5px;
            transition: transform 0.2s;
        }
        details[open] > summary::before { transform: rotate(90deg); }
        
        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 40px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-around;
            padding: 12px;
            z-index: 100;
        }
        .nav-btn {
            color: #A0AEC0;
            font-size: 18px;
            width: 45px;
            height: 45px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        .nav-btn span { font-size: 9px; margin-top: 2px; }
        .nav-active { color: #F6AD55; background-color: rgba(255,255,255,0.1); }

        /* è®°è´¦æœ¬æ ·å¼ */
        .budget-input {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            background: #F7FAFC;
            border: 1px solid #EDF2F7;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <!-- é¡¶éƒ¨ -->
    <header class="sticky top-0 bg-[#FDFBF7]/95 backdrop-blur-sm z-40 px-5 py-4 border-b border-gray-100">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold text-gray-800 tracking-wide">HOKKAIDO <span class="text-orange-400">2026</span></h1>
                <p class="text-[10px] text-gray-500">2æœˆ19æ—¥ - 2æœˆ27æ—¥ | 7å¤©6å¤œ</p>
            </div>
            <div class="text-right">
                <div class="text-xs bg-white border px-2 py-1 rounded-full shadow-sm">
                    <i class="fas fa-wallet text-green-500 mr-1"></i> <span id="header-budget">RM 0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- TAB 1: æ™ºèƒ½è¡Œç¨‹ -->
    <main id="view-itinerary" class="px-4 mt-6 fade-in pb-10">
        <div id="timeline-container">
            <!-- JS æ¸²æŸ“å†…å®¹ -->
        </div>
        <div class="text-center text-gray-300 text-xs py-8">è¡Œç¨‹ç»“æŸ Â· å›å¿†å¼€å§‹</div>
    </main>

    <!-- TAB 2: è®°è´¦æœ¬ & å·¥å…· -->
    <main id="view-wallet" class="px-4 mt-6 hidden fade-in space-y-6">
        
        <!-- æ±‡ç‡è®¾ç½® -->
        <div class="card p-4 flex justify-between items-center bg-gray-800 text-white">
            <div class="text-sm font-bold">å½“å‰æ±‡ç‡è®¾ç½®</div>
            <div class="flex items-center gap-2">
                <span class="text-xs text-gray-400">100 JPY = </span>
                <input type="number" id="exchange-rate" value="3.00" class="w-16 p-1 text-center text-black rounded font-bold" onchange="updateTotal()">
                <span class="text-xs text-gray-400">MYR</span>
            </div>
        </div>

        <!-- è®°è´¦è¾“å…¥åŒº -->
        <div class="card p-5">
            <h3 class="font-bold text-gray-800 mb-4"><i class="fas fa-pen mr-2 text-orange-400"></i>æ–°å¢æ¶ˆè´¹</h3>
            <input type="text" id="expense-name" placeholder="æ¶ˆè´¹é¡¹ç›® (ä¾‹å¦‚: æ‹‰é¢)" class="budget-input">
            <div class="flex gap-2">
                <input type="number" id="expense-amount" placeholder="æ—¥åœ†é‡‘é¢ (JPY)" class="budget-input">
                <button onclick="addExpense()" class="bg-gray-800 text-white rounded-xl px-6 py-2 font-bold mb-2.5 shadow-lg active:scale-95 transition">
                    è®°è´¦
                </button>
            </div>
        </div>

        <!-- æ¶ˆè´¹åˆ—è¡¨ -->
        <div class="card p-5 min-h-[200px]">
            <div class="flex justify-between items-end mb-4 border-b pb-2">
                <h3 class="font-bold text-gray-800">æ¶ˆè´¹æ˜ç»†</h3>
                <div class="text-right">
                    <div class="text-[10px] text-gray-500">æ€»æ”¯å‡º (MYR)</div>
                    <div class="text-xl font-bold text-green-600" id="total-myr">RM 0.00</div>
                    <div class="text-[10px] text-gray-400" id="total-jpy">Â¥ 0</div>
                </div>
            </div>
            <ul id="expense-list" class="space-y-3 text-sm">
                <!-- åˆ—è¡¨ç”± JS ç”Ÿæˆ -->
                <li class="text-center text-gray-400 text-xs py-4">æš‚æ— è®°å½•</li>
            </ul>
            <button onclick="clearExpenses()" class="w-full mt-4 text-xs text-red-400 hover:text-red-600 border border-red-100 py-2 rounded">æ¸…ç©ºæ‰€æœ‰è®°å½•</button>
        </div>

        <!-- Gemini & å®ç”¨å·¥å…· -->
        <div class="card p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-none">
             <div class="flex justify-between items-center">
                <div>
                    <h3 class="font-bold text-indigo-900">Ask Gemini AI</h3>
                    <p class="text-xs text-indigo-700">è¿™é“èœæ˜¯ä»€ä¹ˆï¼Ÿç¿»è¯‘ä¸€ä¸‹èœå•</p>
                </div>
                <a href="https://gemini.google.com/" target="_blank" class="bg-indigo-600 text-white px-3 py-1.5 rounded-lg text-xs shadow">
                    æ‰“å¼€ AI
                </a>
            </div>
        </div>
    </main>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <nav class="bottom-nav">
        <button onclick="switchTab('itinerary')" id="btn-itinerary" class="nav-btn nav-active">
            <i class="fas fa-map-location-dot"></i>
            <span>è¡Œç¨‹</span>
        </button>
        <button onclick="switchTab('wallet')" id="btn-wallet" class="nav-btn">
            <i class="fas fa-calculator"></i>
            <span>è®°è´¦</span>
        </button>
    </nav>

    <script>
        // ================= æ•°æ®æº (AIå¯¼æ¸¸å¢å¼ºç‰ˆ + ç»çº¬åº¦) =================
        const itineraryData = [
            {
                date: "19/02 (Thu)",
                location: "æœ­å¹Œ Sapporo",
                lat: 43.0618, lon: 141.3545, // æœ­å¹Œåæ ‡
                items: [
                    { 
                        time: "20:47", 
                        title: "æŠµè¾¾ & æ™šé¤", 
                        icon: "fa-utensils",
                        nav: "Tsukemen Ichi Sapporo",
                        desc: "Check-in åç›´æ¥å‰å¾€æ™šé¤ã€‚",
                        mustEat: "æ²¾é¢ (Tsukemen Ichi) - æµ“éƒé±¼ä»‹è±šéª¨æ±¤å¤´",
                        menu: "ç‰¹åˆ¶æ²¾é¢ (Tokusei Tsukemen), æ¸©æ³‰è›‹",
                        story: "ã€æ”»ç•¥ã€‘è¿™å®¶åº—è¥ä¸šåˆ°å‡Œæ™¨3ç‚¹ï¼Œæ˜¯Susukinoå¤œç”Ÿæ´»çš„ä»£è¡¨ã€‚æ²¾é¢çš„åƒæ³•æ˜¯æŠŠå†·é¢è˜¸ç€çƒ­æ±¤åƒï¼Œæœ€åå¯ä»¥å«åº—å‘˜åŠ é«˜æ±¤(Soup-wari)å–æ‰æ±¤åº•ã€‚"
                    },
                    { 
                        time: "å®µå¤œ", 
                        title: "Gindaco ç« é±¼çƒ§", 
                        icon: "fa-fire",
                        nav: "Gindaco Susukino",
                        menu: "æ˜å¤ªå­èŠå£«ç« é±¼çƒ§",
                        story: "å°±åœ¨é…’åº—é™„è¿‘ï¼Œçš®è„†å†…è½¯æ˜¯å®ƒçš„ç‰¹è‰²ã€‚é€‚åˆä¹°å›é…’åº—é…å•¤é…’ã€‚"
                    }
                ]
            },
            {
                date: "20/02 (Fri)",
                location: "å¯Œè‰¯é‡ Furano",
                lat: 43.3421, lon: 142.3832, // å¯Œè‰¯é‡åæ ‡
                items: [
                    {
                        time: "09:00",
                        title: "Espresso D Works",
                        icon: "fa-coffee",
                        nav: "Espresso D Works Sapporo",
                        mustEat: "èˆ’èŠ™è•¾æ¾é¥¼ (Souffle Pancake)",
                        story: "ä¸œäº¬ååº—è¿›é©»æœ­å¹Œï¼Œä»¥æå…¶æ¾è½¯çš„'äº‘æœµå£æ„Ÿ'æ¾é¥¼é—»åã€‚"
                    },
                    {
                        time: "16:00",
                        title: "æ£®æ—ç²¾çµéœ²å°",
                        icon: "fa-tree",
                        nav: "Ningle Terrace",
                        mustBuy: "æ£®ä¹‹çš®åŒ (çŒ«å¤´é¹°æœ¨é›•)ã€é›ªä¹‹ç»“æ™¶é“¶é¥°",
                        story: "ã€æ•…äº‹ã€‘'Ningle'åœ¨é˜¿ä¼ŠåŠªè¯­ä¸­æ„ä¸º'æ£®æ—é‡Œçš„å°çŸ®äºº'ã€‚è¿™é‡Œç”±ä½œå®¶ä»“æœ¬èªè®¾è®¡ã€‚å»ºè®®16:00å·¦å³åˆ°è¾¾ï¼Œå¯ä»¥åŒæ—¶çœ‹åˆ°ç™½å¤©é›ªæ™¯å’Œæ—¥è½åçš„ç‚¹ç¯æ¢¦å¹»åœºæ™¯ã€‚"
                    },
                    {
                        time: "19:00",
                        title: "La Vista Furano",
                        icon: "fa-hot-tub-person",
                        nav: "La Vista Furano Hills",
                        story: "ã€æ”»ç•¥ã€‘ä¸€å®šè¦å»é¡¶æ¥¼çš„å¤§æµ´åœºï¼Œæ³¡å®Œæ¾¡åä¼‘æ¯åŒºæœ‰å…è´¹çš„å†°æ£’(Ice Candy)å’Œå…»ä¹å¤šã€‚å¦å¤–ï¼Œä»–ä»¬çš„å¤œé¸£æ‹‰é¢(æ™šä¸Šå…è´¹æä¾›)ä¹Ÿä¸è¦é”™è¿‡ï¼"
                    }
                ]
            },
            {
                date: "21/02 (Sat)",
                location: "å¯Œè‰¯é‡æ»‘é›ª",
                lat: 43.3421, lon: 142.3832,
                items: [
                    { time: "09:00", title: "FISS æ»‘é›ªè¯¾", icon: "fa-person-skiing", nav: "Furano International Snowsports School", desc: "å…¨å¤©æ»‘é›ªä½“éªŒã€‚", story: "è®°å¾—æå‰30åˆ†é’Ÿå»è¯•ç©¿è£…å¤‡ã€‚" },
                    { time: "åˆé¤", title: "æ»‘é›ªåœºé¤å…", icon: "fa-utensils", nav: "Furano Ski Resort", menu: "åŒ—æµ·é“çŒªæ’å’–å–±é¥­" }
                ]
            },
            {
                date: "22/02 (Sun)",
                location: "æœ­å¹Œ Sapporo",
                lat: 43.0618, lon: 141.3545,
                items: [
                    {
                        time: "æ™šé¤",
                        title: "å…ƒç¥–æ‹‰é¢æ¨ªä¸",
                        icon: "fa-bowl-food",
                        nav: "Ganso Ramen Yokocho",
                        mustEat: "å€ç…èˆ (Baisensha) å‘³å™Œæ‹‰é¢",
                        menu: "é¦™ç…å‘³å™Œæ‹‰é¢ (Roasted Miso Ramen)",
                        story: "ã€å†å²ã€‘è¿™é‡Œæ˜¯æœ­å¹Œå‘³å™Œæ‹‰é¢çš„å‘æºåœ°ä¹‹ä¸€ã€‚ä¸€æ¡çª„å··æ±‡é›†äº†17å®¶ååº—ã€‚å¦‚æœå€ç…èˆæ’é˜Ÿå¤ªé•¿ï¼Œ'å¼Ÿå­å±ˆ'ä¹Ÿæ˜¯éå¸¸æ£’çš„é€‰æ‹©ã€‚"
                    }
                ]
            },
            {
                date: "23/02 (Mon)",
                location: "ç™»åˆ« & æ´çˆ·æ¹–",
                lat: 42.4132, lon: 141.1074, // ç™»åˆ«åæ ‡
                items: [
                    {
                        time: "09:00",
                        title: "ç™»åˆ«åœ°ç‹±è°·",
                        icon: "fa-mountain",
                        nav: "Noboribetsu Jigokudani",
                        story: "ã€å¿…çœ‹ã€‘ç›´å¾„450ç±³çš„ç«å±±å£é—è¿¹ï¼Œç»ˆå¹´çƒŸé›¾ç¼­ç»•ã€‚æ²¿ç€æœ¨æ ˆé“èµ°åˆ°'é“æ³‰æ± 'å¯ä»¥çœ‹åˆ°é—´æ­‡æ³‰ç…®æ²¸çš„æ ·å­ã€‚å°å¿ƒåœ°æ»‘ï¼"
                    },
                    {
                        time: "15:30",
                        title: "æ”¯ç¬æ¹–å†°æ¶›ç¥­",
                        icon: "fa-icicles",
                        nav: "Lake Shikotsu Ice Festival",
                        story: "ã€æ”»ç•¥ã€‘æ”¯ç¬æ¹–æ˜¯æ—¥æœ¬æœ€åŒ—çš„ä¸å†»æ¹–ã€‚å†°æ¶›ç¥­æ˜¯æŠ½å–æ¹–æ°´å–·æ´’å†»ç»“è€Œæˆçš„å†°é›•ã€‚æ—¥è½åï¼ˆ16:30åï¼‰ç¯å…‰äº®èµ·æ‰æ˜¯æœ€ç¾çš„æ—¶åˆ»ï¼Œå‘ˆç°æ¢¦å¹»çš„æ”¯ç¬æ¹–è“(Shikotsu Blue)ã€‚"
                    }
                ]
            },
            {
                date: "24/02 (Tue)",
                location: "æœ­å¹Œå¸‚åŒº",
                lat: 43.0618, lon: 141.3545,
                items: [
                    {
                        time: "08:00",
                        title: "åœºå¤–å¸‚åœº",
                        icon: "fa-fish",
                        nav: "Jyogai Market",
                        mustEat: "å¸ç‹èŸ¹ã€æµ·èƒ†ç›–é¥­ã€å“ˆå¯†ç“œ(å¦‚æœæœ‰)",
                        story: "æ¯”äºŒæ¡å¸‚åœºæ›´ä¾¿å®œã€æ›´åœ°é“ã€‚æ¨è'åŒ—ä¹‹ç¾å‘³äº­'ï¼Œå¯ä»¥ç›´æ¥åœ¨åº—é‡Œé€‰æ´»èŸ¹ï¼Œä»–ä»¬å¸®ä½ æ¸…è’¸æˆ–BBQã€‚"
                    },
                    {
                        time: "12:00",
                        title: "æ±¤å’–å–± å¥¥èŠå•†åº—",
                        icon: "fa-bowl-rice",
                        nav: "Soup Curry Okushiba Store Ekimae Soseiji",
                        menu: "è™¾æ±¤åº• (Ebi Soup) + æ±‰å ¡è‚‰æˆ–é¸¡è…¿",
                        story: "ã€å¿…ç‚¹ã€‘æ±¤å’–å–±æ˜¯æœ­å¹Œçš„çµé­‚ç¾é£Ÿã€‚å¥¥èŠå•†åº—çš„ç‰¹è‰²æ˜¯ç”¨2000åªç”œè™¾ç†¬åˆ¶çš„æ±¤åº•ï¼Œé²œå‘³ææµ“ï¼"
                    },
                    {
                        time: "æ™šä¸Š",
                        title: "ç‹¸å°è·¯å•†åº—è¡—",
                        icon: "fa-bag-shopping",
                        nav: "Tanukikoji Shopping Street",
                        mustBuy: "ç™½è‰²æ‹äººã€è–¯æ¡ä¸‰å…„å¼Ÿã€å…­èŠ±äº­è‰è“å·§å…‹åŠ›ã€Sapporo Classicå•¤é…’(åŒ—æµ·é“é™å®š)",
                        story: "å”å‰è¯ƒå¾·åœ¨ç‹¸å°è·¯3-4ä¸ç›®é™„è¿‘ï¼Œ24å°æ—¶è¥ä¸šã€‚è¯å¦†é€šå¸¸æ¯”æœºåœºä¾¿å®œã€‚"
                    }
                ]
            },
            {
                date: "25/02 (Wed)",
                location: "å°æ¨½ Otaru",
                lat: 43.1907, lon: 140.9947, // å°æ¨½åæ ‡
                items: [
                    {
                        time: "æ¼«æ­¥",
                        title: "å ºç”ºé€šå•†åº—è¡—",
                        icon: "fa-cookie-bite",
                        nav: "Sakaimachi Street",
                        mustEat: "LeTAO åŒå±‚èŠå£«è›‹ç³•ã€åŒ—è“æ¥¼'æ¢¦ä¸æ€è®®'æ³¡èŠ™ã€å…­èŠ±äº­ç‰›æ²¹å¤¹å¿ƒé¥¼",
                        mustBuy: "å°æ¨½éŸ³ä¹ç›’å ‚çš„æ°´æ™¶éŸ³ä¹ç›’ã€åŒ—ä¸€ç¡å­çš„ç»ç’ƒæ¯",
                        story: "ã€æ”»ç•¥ã€‘LeTAOæ€»åº—å¡”æ¥¼å¯ä»¥å…è´¹ä¸Šå»çœ‹é£æ™¯ï¼Œè¿˜æä¾›è¯•åƒã€‚åŒ—è“æ¥¼çš„æ³¡èŠ™å»ºè®®ç°åœºåƒï¼Œå¤–çš®é…¥è„†å†…é¦…çˆ†æµ†ã€‚"
                    },
                    {
                        time: "æ™šé¤",
                        title: "å›è½¬å¯¿å¸ Toriton",
                        icon: "fa-sushi",
                        nav: "Toriton Sushi",
                        menu: "å¤§ç‰¡ä¸¹è™¾ã€ç‚™çƒ§ç¼˜ä¾§(Engawa)ã€ç”Ÿå¸¦å­",
                        story: "æœ¬åœ°äººæœ€çˆ±çš„å›è½¬å¯¿å¸ï¼Œæ€§ä»·æ¯”æé«˜ã€‚å› ä¸ºä¸èƒ½é¢„çº¦ï¼Œå»ºè®®é¿å¼€é¥­ç‚¹ï¼ˆä¸‹åˆ4ç‚¹å»ï¼‰æˆ–è€…åšå¥½æ’é˜Ÿ1å°æ—¶çš„å¿ƒç†å‡†å¤‡ã€‚"
                    }
                ]
            }
        ];

        // ================= é€»è¾‘ä»£ç  =================

        // 1. è·å–å¤©æ°”æ•°æ® (Open-Meteo API)
        async function fetchWeather(lat, lon, elementId) {
            try {
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                const data = await response.json();
                
                const temp = Math.round(data.current_weather.temperature);
                const code = data.current_weather.weathercode;
                
                let icon = 'fa-sun';
                let text = 'æ™´';
                
                // ç®€å•çš„ WMO Weather Code è½¬æ¢
                if (code > 0 && code <= 3) { icon = 'fa-cloud'; text = 'å¤šäº‘'; }
                if (code >= 45 && code <= 48) { icon = 'fa-smog'; text = 'é›¾'; }
                if (code >= 51 && code <= 67) { icon = 'fa-cloud-rain'; text = 'é›¨'; }
                if (code >= 71 && code <= 86) { icon = 'fa-snowflake'; text = 'é›ª'; }
                if (code >= 95) { icon = 'fa-bolt'; text = 'é›·é›¨'; }

                const el = document.getElementById(elementId);
                el.innerHTML = `<i class="fas ${icon} text-blue-400"></i> ${temp}Â°C ${text}`;
                el.classList.remove('weather-loading');
                
            } catch (error) {
                document.getElementById(elementId).innerHTML = `<i class="fas fa-wifi text-gray-400"></i> ç¦»çº¿`;
            }
        }

        // 2. æ¸²æŸ“è¡Œç¨‹
        function renderItinerary() {
            const container = document.getElementById('timeline-container');
            let html = '';

            itineraryData.forEach((day, index) => {
                const weatherId = `weather-${index}`;
                
                html += `
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4 sticky top-[70px] z-10 py-2 bg-[#FDFBF7]/95 backdrop-blur-sm">
                            <div class="flex items-center">
                                <span class="bg-gray-800 text-white text-xs font-bold px-3 py-1 rounded-full mr-2 shadow">${day.date}</span>
                                <span class="text-sm font-bold text-gray-700">${day.location}</span>
                            </div>
                            <!-- å¤©æ°”ç»„ä»¶ -->
                            <div id="${weatherId}" class="weather-pill weather-loading">
                                <i class="fas fa-spinner fa-spin"></i> Loading...
                            </div>
                        </div>
                        <div class="space-y-4 pl-2">
                `;

                // è§¦å‘å¤©æ°”è·å–
                setTimeout(() => fetchWeather(day.lat, day.lon, weatherId), 100 * index);

                day.items.forEach(item => {
                    html += `
                        <div class="card p-4 relative overflow-hidden">
                            <div class="flex items-start justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500">
                                        <i class="fas ${item.icon}"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-gray-800 text-[15px]">${item.title}</h3>
                                        <div class="text-[10px] text-gray-400 font-mono">${item.time}</div>
                                    </div>
                                </div>
                                <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.nav)}" target="_blank" class="text-xs bg-gray-100 px-3 py-1.5 rounded-full text-gray-600 font-bold active:bg-gray-200">
                                    <i class="fas fa-location-arrow text-[10px]"></i> Go
                                </a>
                            </div>

                            <!-- äº®ç‚¹æ ‡ç­¾åŒºåŸŸ -->
                            <div class="mt-3 space-y-2">
                                ${item.mustEat ? `<div class="tag-box must-eat"><span class="font-bold">å¿…åƒï¼š</span>${item.mustEat}</div>` : ''}
                                ${item.menu ? `<div class="tag-box must-eat bg-opacity-50"><span class="font-bold">å¿…ç‚¹ï¼š</span>${item.menu}</div>` : ''}
                                ${item.mustBuy ? `<div class="tag-box must-buy"><span class="font-bold">å¿…ä¹°ï¼š</span>${item.mustBuy}</div>` : ''}
                            </div>

                            <!-- æ”»ç•¥æ•…äº‹ -->
                            ${item.story ? `
                            <details class="group mt-2">
                                <summary>å¯¼æ¸¸è¯´æ•…äº‹ & æ”»ç•¥</summary>
                                <div class="story-box p-3 rounded-lg mt-2 text-xs leading-5">
                                    ${item.story}
                                </div>
                            </details>
                            ` : ''}
                        </div>
                    `;
                });
                html += `</div></div>`;
            });
            container.innerHTML = html;
        }

        // 3. è®°è´¦æœ¬é€»è¾‘
        let expenses = JSON.parse(localStorage.getItem('hokkaido_expenses')) || [];

        function addExpense() {
            const name = document.getElementById('expense-name').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            
            if(!name || !amount) {
                alert("è¯·è¾“å…¥é¡¹ç›®åç§°å’Œé‡‘é¢");
                return;
            }

            expenses.push({ name, amount, date: new Date().toLocaleDateString() });
            saveAndRender();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('expense-name').value = '';
            document.getElementById('expense-amount').value = '';
        }

        function deleteExpense(index) {
            if(confirm('ç¡®å®šåˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                expenses.splice(index, 1);
                saveAndRender();
            }
        }

        function clearExpenses() {
            if(confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰è®°è´¦æ•°æ®å—ï¼Ÿ')) {
                expenses = [];
                saveAndRender();
            }
        }

        function saveAndRender() {
            localStorage.setItem('hokkaido_expenses', JSON.stringify(expenses));
            renderExpenses();
        }

        function updateTotal() {
            renderExpenses(); // é‡æ–°è®¡ç®—æ±‡ç‡
        }

        function renderExpenses() {
            const list = document.getElementById('expense-list');
            const rate = parseFloat(document.getElementById('exchange-rate').value) / 100;
            let totalJPY = 0;
            
            if (expenses.length === 0) {
                list.innerHTML = '<li class="text-center text-gray-300 text-xs py-4">æš‚æ— æ¶ˆè´¹è®°å½•ï¼Œå¼€å§‹è®°è´¦å§ï¼</li>';
            } else {
                list.innerHTML = '';
                expenses.forEach((item, index) => {
                    totalJPY += item.amount;
                    const myr = (item.amount * rate).toFixed(2);
                    
                    list.innerHTML += `
                        <li class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-100">
                            <div>
                                <div class="font-bold text-gray-700">${item.name}</div>
                                <div class="text-[10px] text-gray-400">${item.date}</div>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="text-right">
                                    <div class="text-sm font-bold text-gray-800">Â¥${item.amount}</div>
                                    <div class="text-[10px] text-green-600">RM ${myr}</div>
                                </div>
                                <button onclick="deleteExpense(${index})" class="text-gray-300 hover:text-red-400 px-2">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </li>
                    `;
                });
            }

            // æ›´æ–°æ€»é¢
            const totalMYR = (totalJPY * rate).toFixed(2);
            document.getElementById('total-jpy').innerText = `Â¥ ${totalJPY.toLocaleString()}`;
            document.getElementById('total-myr').innerText = `RM ${totalMYR}`;
            document.getElementById('header-budget').innerText = `RM ${Math.round(totalMYR)}`;
        }

        // 4. é¡µé¢åˆ‡æ¢é€»è¾‘
        function switchTab(tab) {
            const viewItinerary = document.getElementById('view-itinerary');
            const viewWallet = document.getElementById('view-wallet');
            const btnItinerary = document.getElementById('btn-itinerary');
            const btnWallet = document.getElementById('btn-wallet');

            if(tab === 'itinerary') {
                viewItinerary.classList.remove('hidden');
                viewWallet.classList.add('hidden');
                btnItinerary.classList.add('nav-active');
                btnWallet.classList.remove('nav-active');
            } else {
                viewItinerary.classList.add('hidden');
                viewWallet.classList.remove('hidden');
                btnItinerary.classList.remove('nav-active');
                btnWallet.classList.add('nav-active');
                renderExpenses();
            }
            window.scrollTo(0,0);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderItinerary();
            renderExpenses();
        });

    </script>
</body>
</html>
